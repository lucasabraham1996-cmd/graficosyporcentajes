<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlassGraph - Creador de Gráficos Modernos</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .light-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #1e293b;
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 32px; height: 32px; padding: 0;
            overflow: hidden; border-radius: 50%; cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen selection:bg-cyan-500 selection:text-white overflow-x-hidden transition-colors duration-500">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- ICONOS ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                pie: <path d="M21.21 15.89A10 10 0 1 1 8 2.83M22 12A10 10 0 0 0 12 2v10z" />,
                activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />,
                circle: <circle cx="12" cy="12" r="10" />,
                bar: <path d="M12 20V10M18 20V4M6 20v-4" />,
                radar: <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2" />,
                download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />,
                copy: <><rect x="9" y="9" width="13" height="13" rx="2" ry="2" /><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" /></>,
                trash: <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></>,
                plus: <><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></>,
                calculator: <><rect x="4" y="2" width="16" height="20" rx="2" /><line x1="8" y1="6" x2="16" y2="6" /><line x1="16" y1="14" x2="16" y2="14" /><line x1="12" y1="14" x2="12" y2="14" /><line x1="8" y1="14" x2="8" y2="14" /><line x1="16" y1="18" x2="16" y2="18" /><line x1="12" y1="18" x2="12" y2="18" /><line x1="8" y1="18" x2="8" y2="18" /></>,
                sun: <><circle cx="12" cy="12" r="5" /><line x1="12" y1="1" x2="12" y2="3" /><line x1="12" y1="21" x2="12" y2="23" /><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" /><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" /><line x1="1" y1="12" x2="3" y2="12" /><line x1="21" y1="12" x2="23" y2="12" /><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" /><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" /></>,
                moon: <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />,
                chart: <><path d="M3 3v18h18" /><path d="M18 17V9" /><path d="M13 17V5" /><path d="M8 17v-3" /></>,
                info: <><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><line x1="3" y1="9" x2="21" y2="9" /><line x1="9" y1="21" x2="9" y2="9" /></>,
                smart: <><rect x="2" y="7" width="20" height="14" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></>,
                pyramid: <path d="M2.5 20h19L12 4z" />,
                star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />,
                dollar: <><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></>,
                user: <><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
                check: <polyline points="20 6 9 17 4 12" />,
                paste: <><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><rect x="8" y="2" width="8" height="4" rx="1" ry="1" /></>,
                x: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
                image: <><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><circle cx="8.5" cy="8.5" r="1.5" /><polyline points="21 15 16 10 5 21" /></>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        // --- UTILIDADES ---
        const exportChart = async (svgElement, action = 'download') => {
            if (!svgElement) return;
            const serializer = new XMLSerializer();
            let source = serializer.serializeToString(svgElement);
            if(!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)){ source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"'); }
            const style = document.createElement('style');
            style.textContent = `text { font-family: 'Inter', system-ui, -apple-system, sans-serif !important; }`;
            source = source.replace(/<defs>/, '<defs>' + style.outerHTML);
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            const bbox = svgElement.getBoundingClientRect();
            const scale = 3; 
            canvas.width = (bbox.width || 500) * scale;
            canvas.height = (bbox.height || 600) * scale;
            const svgBase64 = btoa(unescape(encodeURIComponent(source)));
            const imgSource = `data:image/svg+xml;base64,${svgBase64}`;
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.scale(scale, scale);
                ctx.drawImage(img, 0, 0);
                canvas.toBlob((blob) => {
                    if (!blob) { alert("Error generando imagen."); return; }
                    if (action === 'download') {
                        const link = document.createElement('a');
                        link.download = `GlassGraph-${Date.now()}.png`;
                        link.href = URL.createObjectURL(blob);
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else if (action === 'copy') {
                        try {
                            const item = new ClipboardItem({ 'image/png': blob });
                            navigator.clipboard.write([item]).then(() => alert("¡Gráfico copiado!")).catch(err => alert("Usa descargar."));
                        } catch (err) { alert("Usa descargar."); }
                    }
                }, 'image/png');
            };
            img.src = imgSource;
        };

        const GradientDefs = () => (
            <defs>
                <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur stdDeviation="4" result="coloredBlur" />
                    <feMerge><feMergeNode in="coloredBlur" /><feMergeNode in="SourceGraphic" /></feMerge>
                </filter>
            </defs>
        );

        const ChartTitle = ({ title, width, y = 30, theme }) => {
            if (!title) return null;
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            return (
                <text x={width/2} y={y} textAnchor="middle" fill={textColor} fontSize="24" fontWeight="900" style={{fontFamily: 'Inter, sans-serif', textTransform: 'uppercase', letterSpacing: '1px'}}>
                    {title}
                </text>
            );
        };

        const SVGLegend = ({ categories, width, yStart, theme, showPercent, total }) => {
            const itemHeight = 30;
            const colWidth = width / 2;
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            
            return (
                <g transform={`translate(0, ${yStart})`}>
                    {categories.map((cat, i) => {
                        const x = (i % 2) * colWidth + 20;
                        const y = Math.floor(i / 2) * itemHeight;
                        const val = parseFloat(cat.value) || 0;
                        const percentStr = showPercent && total > 0 ? ` (${Math.round((val/total)*100)}%)` : '';

                        return (
                            <g key={cat.id} transform={`translate(${x}, ${y})`}>
                                <circle r="6" fill={cat.color} cy="-5" />
                                <text x="15" y="0" fill={textColor} fontSize="14" fontWeight="500" style={{fontFamily: 'Inter, sans-serif'}}>
                                    {cat.label}: <tspan fontWeight="bold" fillOpacity="0.7">{cat.value}{percentStr}</tspan>
                                </text>
                            </g>
                        );
                    })}
                </g>
            );
        };

        // --- COMPONENTES GRÁFICOS ---

        // ARROW PIE CHART (AJUSTADO PARA QUE ENTRE TODO)
        const ArrowPieChart = ({ categories, size = 400, theme, title, centerColor, centerIcon, centerImage }) => {
            const total = categories.reduce((acc, curr) => acc + (parseFloat(curr.value)||0), 0);
            const maxValue = Math.max(...categories.map(c => parseFloat(c.value)||0), 1);
            let accumulatedPercent = 0;
            
            // Reduced scale even further so labels and arrows fit nicely
            const baseScale = size / 4.5; 
            
            const titleHeight = title ? 60 : 30;
            const totalHeight = size + titleHeight;
            const centerX = size / 2;
            const centerY = size / 2 + (titleHeight/2);
            
            const textColor = theme === 'dark' ? 'white' : '#1e293b';

            const getCoordinates = (percent, radius) => {
                const x = Math.cos(2 * Math.PI * percent);
                const y = Math.sin(2 * Math.PI * percent);
                return [x * radius, y * radius];
            };

            return (
                <svg width={size} height={totalHeight} viewBox={`0 0 ${size} ${totalHeight}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} y={30} />
                    <defs>
                        {categories.map((cat) => (
                            <linearGradient key={cat.id} id={`pieGrad_${cat.id}`} x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor={cat.color} />
                                <stop offset="100%" stopColor={cat.color} stopOpacity="0.5" />
                            </linearGradient>
                        ))}
                        <radialGradient id="centerGrad">
                            <stop offset="30%" stopColor={centerColor || "#3b82f6"} stopOpacity="0.8" />
                            <stop offset="100%" stopColor={centerColor || "#3b82f6"} stopOpacity="0" />
                        </radialGradient>
                    </defs>

                    <g transform={`translate(${centerX}, ${centerY})`}>
                        <g transform={`rotate(-90)`}>
                            {categories.map((cat) => {
                                const val = parseFloat(cat.value) || 0;
                                if (val <= 0) return null;
                                const percent = val / total;
                                const relativeSize = val / maxValue; 
                                
                                // Radius varies less to keep chart compact
                                const radius = 1.0 + (relativeSize * 0.2);
                                
                                const startPercent = accumulatedPercent;
                                const endPercent = accumulatedPercent + percent;
                                
                                const [startX, startY] = getCoordinates(startPercent, radius * baseScale);
                                const [endX, endY] = getCoordinates(endPercent, radius * baseScale);
                                
                                const midAngle = accumulatedPercent + percent / 2;
                                accumulatedPercent += percent;
                                
                                const largeArcFlag = percent > .5 ? 1 : 0;
                                
                                const pathData = [`M 0 0`, `L ${startX} ${startY}`, `A ${radius * baseScale} ${radius * baseScale} 0 ${largeArcFlag} 1 ${endX} ${endY}`, `Z`].join(' ');

                                const [edgeX, edgeY] = getCoordinates(midAngle, radius * baseScale);
                                // Shorter arrow length relative to circle
                                const arrowLen = 25; 
                                const [arrowEndX, arrowEndY] = getCoordinates(midAngle, (radius * baseScale) + arrowLen);
                                
                                const currentAngleDeg = (midAngle * 360) - 90;
                                // Simple logic to determine text side
                                // 0 to 180 is Right side (since -90 rotation makes 0 top) -> actually 0 to 0.5 percent
                                // Wait, simple X coordinate check is safer after rotation
                                
                                // Calculate unrotated X to determine side
                                const realX = arrowEndX; // relative to center, rotated by parent group? No, parent is rotated.
                                
                                // We need text anchor logic based on angle
                                const isLeft = (midAngle > 0.5);

                                return (
                                    <g key={cat.id}>
                                        <path d={pathData} fill={`url(#pieGrad_${cat.id})`} stroke={theme === 'dark' ? 'rgba(255,255,255,0.1)' : 'white'} strokeWidth="1" filter="url(#glow)" />
                                        <line x1={edgeX} y1={edgeY} x2={arrowEndX} y2={arrowEndY} stroke={textColor} strokeOpacity="0.5" strokeWidth="1.5" />
                                        <circle cx={edgeX} cy={edgeY} r="3" fill={cat.color} />
                                        <g transform={`translate(${arrowEndX}, ${arrowEndY}) rotate(90)`}>
                                            <text 
                                                x={isLeft ? -5 : 5} 
                                                y={0}
                                                dy="0.3em" 
                                                textAnchor={isLeft ? "end" : "start"} 
                                                fill={textColor} 
                                                fontSize="14" 
                                                fontWeight="700" 
                                                style={{fontFamily: 'Inter, sans-serif'}}
                                            >
                                                {cat.label} ({Math.round(percent * 100)}%)
                                            </text>
                                        </g>
                                    </g>
                                );
                            })}
                        </g>
                        <circle cx="0" cy="0" r={baseScale * 0.5} fill="url(#centerGrad)" filter="url(#glow)" />
                        <circle cx="0" cy="0" r={baseScale * 0.45} fill="none" stroke={centerColor} strokeWidth="2" opacity="0.5" />
                        
                        {/* Center Content */}
                        {centerImage ? (
                            <image href={centerImage} x={-baseScale * 0.25} y={-baseScale * 0.25} width={baseScale * 0.5} height={baseScale * 0.5} preserveAspectRatio="xMidYMid slice" clipPath="circle(50%)" />
                        ) : title ? (
                            <text y="5" textAnchor="middle" fill="white" fontSize="10" fontWeight="bold" style={{fontFamily: 'Inter', textTransform:'uppercase'}}>{title.substring(0,8)}</text>
                        ) : (
                            <g transform="translate(-10, -10)" stroke="white" strokeWidth="2">
                                {centerIcon === 'star' && <polygon points="10 1 12.5 7.5 19 8.5 14 13.5 15.5 20 10 16.5 4.5 20 6 13.5 1 8.5 7.5 7.5 10 1" fill="none" transform="scale(1)" />}
                                {centerIcon === 'dollar' && <><line x1="10" y1="0" x2="10" y2="20" /><path d="M14 4H8a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6H6" fill="none" /></>}
                                {centerIcon === 'user' && <><path d="M16 19v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" fill="none" /><circle cx="10" cy="6" r="4" fill="none" /></>}
                                {centerIcon === 'check' && <polyline points="18 5 9 16 3 10" fill="none" />}
                                {(!centerIcon || centerIcon === 'pie') && <path d="M21.21 15.89A10 10 0 1 1 8 2.83M22 12A10 10 0 0 0 12 2v10z" fill="none" transform="scale(0.8)" />}
                            </g>
                        )}
                    </g>
                </svg>
            );
        };

        // RING CHART (Center Alignment Fixed + Percentages in Legend)
        const RingChart = ({ categories, customTotal, size = 400, theme, title, centerLabel, centerImage }) => {
            const safeCategories = categories.map(c => ({...c, value: parseFloat(c.value) || 0}));
            const sumValues = safeCategories.reduce((acc, curr) => acc + curr.value, 0);
            const total = customTotal > 0 ? customTotal : sumValues; 
            const safeTotal = total > 0 ? total : 1; 

            let currentAngle = 0;
            const radius = 130; 
            const stroke = 30;
            const normalizedRadius = radius - stroke / 2;
            const circumference = normalizedRadius * 2 * Math.PI;
            const totalHeight = size + 60;
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            const trackColor = theme === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';

            // Center content logic
            const centerMainText = centerLabel ? centerLabel : `${Math.round((sumValues / safeTotal) * 100)}%`;
            const centerSubText = `${sumValues} / ${total}`;

            return (
                <svg width={size} height={totalHeight} viewBox={`0 0 ${size} ${totalHeight}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform={`translate(0, 50)`}>
                        <circle cx={size/2} cy={size/2} r={normalizedRadius} fill="none" stroke={trackColor} strokeWidth={stroke}/>
                        {safeCategories.map((cat, i) => {
                            if (cat.value <= 0) return null;
                            const percentage = cat.value / safeTotal;
                            const safePercent = Math.min(percentage, 1); 
                            const dashArray = `${safePercent * circumference} ${circumference}`;
                            const offset = -currentAngle; 
                            const elem = (<circle key={cat.id} cx={size/2} cy={size/2} r={normalizedRadius} fill="none" stroke={cat.color} strokeWidth={stroke} strokeDasharray={dashArray} strokeDashoffset={offset} strokeLinecap="round" filter="url(#glow)" transform={`rotate(-90 ${size/2} ${size/2})`} style={{ transition: 'all 0.5s ease' }}/>);
                            currentAngle += safePercent * circumference;
                            return elem;
                        })}
                        
                        {centerImage ? (
                             <image href={centerImage} x={(size/2)-40} y={(size/2)-40} width="80" height="80" preserveAspectRatio="xMidYMid slice" clipPath="circle(50%)" />
                        ) : (
                            <>
                                {/* Use dominant-baseline central for perfect centering */}
                                <text x="50%" y={size/2} dy="-0.2em" textAnchor="middle" dominantBaseline="central" fill={textColor} fontSize="56" fontWeight="800" style={{fontFamily: 'Inter'}}>{centerMainText}</text>
                                <text x="50%" y={size/2} dy="1.8em" textAnchor="middle" dominantBaseline="central" fill={textColor} fillOpacity="0.5" fontSize="16" style={{fontFamily: 'Inter'}}>{centerSubText}</text>
                            </>
                        )}
                    </g>
                    <SVGLegend categories={safeCategories} width={size} yStart={size + 20} theme={theme} showPercent={true} total={safeTotal} />
                </svg>
            );
        };

        // PROCESS SMART CHART
        const ProcessSmartChart = ({ categories, size = 400, theme, title }) => {
            const gap = 30;
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            
            let currentY = 60;
            const items = categories.map((cat) => {
                const text = cat.value || "";
                const charsPerLine = 40; 
                const lines = Math.ceil(text.length / charsPerLine) || 1;
                const height = Math.max(60, 40 + (lines * 20)); 
                const pos = currentY;
                currentY += height + gap;
                return { ...cat, height, y: pos };
            });
            
            const totalHeight = currentY + 30;

            return (
                <svg width={size} height={totalHeight} viewBox={`0 0 ${size} ${totalHeight}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform="translate(0, 0)">
                        {items.map((cat, i) => {
                            const isLast = i === items.length - 1;
                            return (
                                <g key={cat.id} transform={`translate(20, ${cat.y})`}>
                                    {!isLast && <line x1="25" y1={cat.height} x2="25" y2={cat.height + gap} stroke={cat.color} strokeWidth="2" strokeDasharray="4" />}
                                    <circle cx="25" cy={cat.height/2} r="20" fill={cat.color} filter="url(#glow)" />
                                    <text x="25" y={cat.height/2} dy="0.3em" textAnchor="middle" fill="white" fontWeight="bold">{i+1}</text>
                                    <rect x="60" y="0" width={size - 80} height={cat.height} rx="10" fill={cat.color} fillOpacity="0.15" stroke={cat.color} strokeOpacity="0.5" />
                                    <foreignObject x="75" y="10" width={size - 130} height={cat.height - 20}>
                                        <div xmlns="http://www.w3.org/1999/xhtml" style={{display:'flex', flexDirection:'column', justifyContent:'center', height:'100%', color: textColor, fontFamily: 'Inter, sans-serif'}}>
                                            <div style={{fontWeight:'bold', fontSize:'16px', lineHeight:'1.2', marginBottom:'4px'}}>{cat.label}</div>
                                            <div style={{fontSize:'13px', opacity:0.8, lineHeight:'1.3', wordWrap: 'break-word', overflowWrap: 'anywhere'}}>{cat.value}</div>
                                        </div>
                                    </foreignObject>
                                </g>
                            )
                        })}
                    </g>
                </svg>
            );
        };

        // CYCLE SMART CHART
        const CycleSmartChart = ({ categories, size = 400, theme, title, centerLabel }) => {
            const maxTextLen = Math.max(...categories.map(c => (c.value || "").length));
            const bubbleRadius = Math.max(45, 30 + Math.sqrt(maxTextLen) * 5); 
            const layoutRadius = Math.max(130, size/2 * 0.5 + (bubbleRadius - 45)); 
            
            const centerX = size / 2;
            const centerY = size / 2 + 20;
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            
            const totalSize = (layoutRadius + bubbleRadius) * 2 + 60;
            const viewBoxStart = centerX - totalSize/2;

            return (
                <svg width={size} height={totalSize} viewBox={`${viewBoxStart} ${centerY - totalSize/2} ${totalSize} ${totalSize}`}>
                    <GradientDefs />
                    {title && <text x={centerX} y={centerY - totalSize/2 + 40} textAnchor="middle" fill={textColor} fontSize="24" fontWeight="900" style={{fontFamily: 'Inter, sans-serif', textTransform: 'uppercase'}}>{title}</text>}
                    <g transform={`translate(${centerX}, ${centerY})`}>
                        <circle r="45" fill={theme === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)'} stroke={textColor} strokeOpacity="0.2" />
                        <text dy="0.3em" textAnchor="middle" fill={textColor} fontSize="12" fontWeight="bold">{centerLabel || "CICLO"}</text>
                        {categories.map((cat, i) => {
                            const angle = (i * 2 * Math.PI) / categories.length - Math.PI / 2;
                            const x = Math.cos(angle) * layoutRadius;
                            const y = Math.sin(angle) * layoutRadius;
                            
                            return (
                                <g key={cat.id}>
                                    <line x1="0" y1="0" x2={x} y2={y} stroke={cat.color} strokeWidth="1" strokeOpacity="0.5" />
                                    <circle cx={x} cy={y} r={bubbleRadius} fill={cat.color} fillOpacity="0.2" stroke={cat.color} strokeWidth="2" filter="url(#glow)" />
                                    <foreignObject x={x - bubbleRadius + 10} y={y - bubbleRadius + 10} width={bubbleRadius * 2 - 20} height={bubbleRadius * 2 - 20}>
                                        <div xmlns="http://www.w3.org/1999/xhtml" style={{display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center', height:'100%', color: textColor, textAlign:'center', lineHeight:'1.2'}}>
                                            <span style={{fontWeight:'bold', fontSize:'12px', marginBottom:'4px'}}>{cat.label}</span>
                                            <span style={{opacity:0.9, fontSize:'11px', wordWrap:'break-word', overflowWrap: 'anywhere'}}>{cat.value}</span>
                                        </div>
                                    </foreignObject>
                                </g>
                            );
                        })}
                    </g>
                </svg>
            );
        };

        // TABLE POSITIONS (Fixed Overlap)
        const PositionTableChart = ({ categories, size = 400, theme, title }) => {
            const sortedCats = [...categories].sort((a, b) => (parseFloat(b.value)||0) - (parseFloat(a.value)||0));
            const maxValue = Math.max(...categories.map(c => parseFloat(c.value)||0), 1);
            const barHeight = 50;
            const gap = 15;
            const totalHeight = categories.length * (barHeight + gap) + 60; 
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            const trackColor = theme === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';
            
            // Increased left margin to 80 to avoid overlap with rank number
            const contentStartX = 80;

            return (
                <svg width={size} height={totalHeight} viewBox={`0 0 ${size} ${totalHeight}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform={`translate(0, 60)`}>
                        {sortedCats.map((cat, i) => {
                            const y = i * (barHeight + gap);
                            const val = parseFloat(cat.value) || 0;
                            const percent = (val / maxValue);
                            const width = percent * (size - contentStartX - 80); // Adjusted width calc
                            return (
                                <g key={cat.id} transform={`translate(20, ${y})`}>
                                    <text x="0" y="38" fontSize="32" fontWeight="900" fill={cat.color} style={{fontFamily: 'Inter'}}>#{i + 1}</text>
                                    <g transform={`translate(${contentStartX}, 0)`}>
                                        <text x="0" y="15" fill={textColor} fontSize="14" fontWeight="600">{cat.label}</text>
                                        <text x={size - contentStartX - 40} y="32" textAnchor="end" fill={cat.color} fontSize="14" fontWeight="bold">{cat.value}</text>
                                        <rect x="0" y="25" width={size - contentStartX - 60} height="8" rx="4" fill={trackColor} />
                                        <rect x="0" y="25" width={width} height="8" rx="4" fill={cat.color} filter="url(#glow)" />
                                    </g>
                                </g>
                            )
                        })}
                    </g>
                </svg>
            );
        };

        // --- OTROS (Pyramid, Radar, Comparative, Bar, Gauge) ---
        const PyramidSmartChart = ({ categories, size = 400, theme, title }) => {
            const sorted = [...categories].sort((a,b) => (parseFloat(a.value)||0) - (parseFloat(b.value)||0)); 
            const heightStep = (size - 60) / categories.length;
            return (
                <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform={`translate(${size/2}, 60)`}>
                        {sorted.map((cat, i) => {
                            const topW = i * (size / categories.length / 2);
                            const botW = (i + 1) * (size / categories.length / 2);
                            const y = i * heightStep;
                            const path = `M ${-topW} ${y} L ${topW} ${y} L ${botW} ${y + heightStep - 5} L ${-botW} ${y + heightStep - 5} Z`;
                            return (
                                <g key={cat.id}>
                                    <path d={path} fill={cat.color} stroke="white" strokeOpacity="0.2" filter="url(#glow)" />
                                    <text y={y + heightStep/2} dy="0.3em" textAnchor="middle" fill="white" fontWeight="bold" fontSize="14">{cat.label}</text>
                                </g>
                            )
                        })}
                    </g>
                </svg>
            );
        };

        const RadarChart = ({ categories, size = 400, theme, title }) => {
            const maxValue = Math.max(...categories.map(c => parseFloat(c.value)||0), 1);
            const titleHeight = title ? 50 : 0;
            const radius = size / 2 - 60;
            const centerX = size / 2;
            const centerY = size / 2;
            const totalHeight = size + titleHeight;
            const gridColor = theme === 'dark' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            const points = categories.map((cat, i) => {
                const angle = i * angleSlice - Math.PI / 2;
                const valueRadius = ((parseFloat(cat.value)||0) / maxValue) * radius;
                return [centerX + Math.cos(angle) * valueRadius, centerY + Math.sin(angle) * valueRadius];
            }).map(p => p.join(',')).join(' ');
            return (
                <svg width={size} height={totalHeight} viewBox={`0 0 ${size} ${totalHeight}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform={`translate(0, ${titleHeight})`}>
                        {Array.from({ length: 4 }).map((_, l) => {
                            const levelRadius = (radius / 4) * (l + 1);
                            const levelPoints = categories.map((_, i) => {
                                const angle = i * angleSlice - Math.PI / 2;
                                return [centerX + Math.cos(angle) * levelRadius, centerY + Math.sin(angle) * levelRadius];
                            }).map(p => p.join(',')).join(' ');
                            return <polygon key={l} points={levelPoints} fill="none" stroke={gridColor} strokeWidth="1" />;
                        })}
                        {categories.map((_, i) => { const angle = (i * 2 * Math.PI) / categories.length - Math.PI / 2; return <line key={i} x1={centerX} y1={centerY} x2={centerX + Math.cos(angle) * radius} y2={centerY + Math.sin(angle) * radius} stroke={gridColor} />; })}
                        <polygon points={points} fill="rgba(6, 182, 212, 0.4)" stroke="#22d3ee" strokeWidth="2" filter="url(#glow)"/>
                        {categories.map((cat, i) => { const angle = i * angleSlice - Math.PI / 2; const r = ((parseFloat(cat.value)||0) / maxValue) * radius; return <circle key={i} cx={centerX + Math.cos(angle) * r} cy={centerY + Math.sin(angle) * r} r="4" fill={cat.color} stroke="white" strokeWidth="1" />; })}
                    </g>
                    <SVGLegend categories={categories} width={size} yStart={size + titleHeight - 20} theme={theme} />
                </svg>
            );
        }

        const ComparativeBarChart = ({ categories, size = 400, theme, title }) => {
            const maxValue = Math.max(...categories.map(c => parseFloat(c.value)||0), 1);
            const titleHeight = title ? 50 : 0;
            const barHeight = 40;
            const gap = 20;
            const chartHeight = categories.length * (barHeight + gap);
            const viewBoxHeight = Math.max(size, chartHeight + 40 + titleHeight);
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            const maxBarWidth = size - 160; 
            return (
                <svg width={size} height={viewBoxHeight} viewBox={`0 0 ${size} ${viewBoxHeight}`}>
                    <GradientDefs />
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform={`translate(0, ${titleHeight + 20})`}>
                        {categories.map((cat, i) => {
                            const y = i * (barHeight + gap);
                            const val = parseFloat(cat.value) || 0;
                            const width = (val / maxValue) * maxBarWidth;
                            const textValueX = 100 + width + 10;
                            return (
                                <g key={cat.id} transform={`translate(0, ${y})`}>
                                    <text x="0" y={barHeight/2} dy="0.3em" fill={textColor} fontSize="14" fontWeight="600">{cat.label}</text>
                                    <rect x="100" y="0" width={maxBarWidth} height={barHeight} rx={barHeight/2} fill={theme === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)'} />
                                    <rect x="100" y="0" width={width} height={barHeight} rx={barHeight/2} fill={cat.color} filter="url(#glow)" />
                                    <text x={textValueX} y={barHeight/2} dy="0.3em" fill={textColor} fontSize="14" fontWeight="bold">{cat.value}</text>
                                </g>
                            )
                        })}
                    </g>
                </svg>
            );
        };

        const BarChart = ({ label, value, max, color1, color2, size = 400, theme, title }) => {
            const percent = Math.min(100, (value / (max || 100)) * 100);
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            const trackColor = theme === 'dark' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)';
            return (
                <svg width={size} height={200} viewBox={`0 0 ${size} 200`}>
                    <defs><linearGradient id="gradBar" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stopColor={color1} /><stop offset="100%" stopColor={color2} /></linearGradient><filter id="glowBar"><feGaussianBlur stdDeviation="2.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform={`translate(0, 50)`}>
                        <text x="0" y="30" fill={textColor} fontSize="18" fontWeight="600">{label}</text>
                        <text x={size} y="30" textAnchor="end" fill={textColor} fontSize="16">{value} / {max}</text>
                        <rect x="0" y="45" width={size} height="24" rx="12" fill={trackColor} />
                        <rect x="0" y="45" width={(percent / 100) * size} height="24" rx="12" fill="url(#gradBar)" filter="url(#glowBar)" />
                        <g style={{ transform: `translateX(${(percent / 100) * size}px)` }}><circle cx="0" cy="57" r="6" fill={theme === 'dark'?'white':'#333'} /><text x="0" y="95" textAnchor="middle" fill={color2} fontSize="20" fontWeight="bold">{percent.toFixed(1)}%</text></g>
                    </g>
                </svg>
            );
        };

        const GaugeChart = ({ label, value, max, color1, color2, size = 400, theme, title }) => {
            const percent = Math.min(100, (value / (max || 100)) * 100);
            const textColor = theme === 'dark' ? 'white' : '#1e293b';
            return (
                <svg width={size} height={size/1.5 + 50} viewBox={`0 -20 ${size} ${size/1.5 + 50}`}>
                    <defs><linearGradient id="gradGauge" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stopColor={color1} /><stop offset="100%" stopColor={color2} /></linearGradient><filter id="glowGauge"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
                    <ChartTitle title={title} width={size} theme={theme} />
                    <g transform="translate(0, 40)">
                        <path d={`M 30 ${size/2} A ${size/2 - 25} ${size/2 - 25} 0 0 1 ${size - 30} ${size/2}`} stroke={theme==='dark'?'rgba(255,255,255,0.1)':'rgba(0,0,0,0.1)'} strokeWidth="25" fill="none" strokeLinecap="round" />
                        <path d={`M 30 ${size/2} A ${size/2 - 25} ${size/2 - 25} 0 0 1 ${size - 30} ${size/2}`} stroke="url(#gradGauge)" strokeWidth="25" fill="none" strokeDasharray={(size/2 - 25) * Math.PI} strokeDashoffset={(size/2 - 25) * Math.PI * (1 - percent/100)} strokeLinecap="round" filter="url(#glowGauge)" style={{transition:'stroke-dashoffset 0.6s'}} />
                        <text x="50%" y={size/2 - 20} textAnchor="middle" fill={textColor} fontSize="42" fontWeight="bold">{percent.toFixed(0)}%</text>
                        <text x="50%" y={size/2 + 20} textAnchor="middle" fill={textColor} fontSize="16">{label}</text>
                    </g>
                </svg>
            );
        };

        const CalcInput = ({ val, onChange }) => (
            <input type="number" value={val} onChange={e => onChange(parseFloat(e.target.value)||0)} className="bg-white/10 border-b-2 border-white/20 px-2 py-1 w-24 text-center text-cyan-300 focus:outline-none focus:border-cyan-400 font-bold" />
        );

        const CalculatorTab = () => {
            const [vals, setVals] = useState({ c1_p: 20, c1_t: 150, c2_p: 30, c2_t: 120, c3_o: 500, c3_n: 750, c4_p: 100, c4_d: 15, c5_c: 50, c5_p: 80 });
            return (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">
                    <div className="glass-panel p-6 rounded-2xl flex flex-col gap-4">
                        <h3 className="text-cyan-400 font-bold flex items-center gap-2"><Icon name="circle" size={16}/> % de un Total</h3>
                        <div className="text-lg text-slate-300">¿Cuánto es el <CalcInput val={vals.c1_p} onChange={v=>setVals(p=>({...p,c1_p:v}))}/> % de <CalcInput val={vals.c1_t} onChange={v=>setVals(p=>({...p,c1_t:v}))}/>?</div>
                        <div className="mt-auto text-3xl font-black text-white">{((vals.c1_t * vals.c1_p)/100).toFixed(2)}</div>
                    </div>
                    {/* Tarjetas simplificadas para mostrar estructura */}
                    <div className="glass-panel p-6 rounded-2xl flex flex-col gap-4"><h3 className="text-pink-400 font-bold flex items-center gap-2"><Icon name="pie" size={16}/> Qué Porcentaje Es</h3><div className="text-lg text-slate-300">Si tengo <CalcInput val={vals.c2_p} onChange={v=>setVals(p=>({...p,c2_p:v}))}/> de <CalcInput val={vals.c2_t} onChange={v=>setVals(p=>({...p,c2_t:v}))}/>, ¿qué % es?</div><div className="mt-auto text-3xl font-black text-white">{vals.c2_t?((vals.c2_p/vals.c2_t)*100).toFixed(2):0}%</div></div>
                    <div className="glass-panel p-6 rounded-2xl flex flex-col gap-4"><h3 className="text-emerald-400 font-bold flex items-center gap-2"><Icon name="activity" size={16}/> Crecimiento</h3><div className="text-lg text-slate-300">De <CalcInput val={vals.c3_o} onChange={v=>setVals(p=>({...p,c3_o:v}))}/> a <CalcInput val={vals.c3_n} onChange={v=>setVals(p=>({...p,c3_n:v}))}/>, ¿cuánto cambió?</div><div className="mt-auto text-3xl font-black text-white">{vals.c3_o?((vals.c3_n-vals.c3_o)/vals.c3_o*100).toFixed(2):0}%</div></div>
                </div>
            );
        };

        const PasteModal = ({ onClose, onPaste, onImagePaste }) => {
            const [text, setText] = useState("");
            
            const handlePaste = (e) => {
                const items = e.clipboardData.items;
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf("image") !== -1) {
                        const blob = items[i].getAsFile();
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            onImagePaste(event.target.result);
                        };
                        reader.readAsDataURL(blob);
                        e.preventDefault();
                        return; // Stop if image found
                    }
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                    <div className="glass-panel p-6 rounded-2xl w-full max-w-lg relative bg-slate-900 border border-white/20 shadow-2xl">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white"><Icon name="x" size={20}/></button>
                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><Icon name="paste" /> Pegado Inteligente</h3>
                        <p className="text-sm text-slate-300 mb-3">Pega tus datos (Excel/Texto) o <b>una imagen</b> directamente aquí (Ctrl+V).</p>
                        <textarea 
                            value={text} 
                            onChange={e=>setText(e.target.value)} 
                            onPaste={handlePaste}
                            className="w-full h-40 bg-black/30 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-cyan-500 outline-none mb-4 font-mono"
                            placeholder="Ejemplo Datos:\nProducto A\t100\nProducto B\t200\n\nO pega una imagen..."
                        />
                        <button 
                            onClick={() => onPaste(text)}
                            className="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-xl font-bold text-white shadow-lg hover:shadow-cyan-500/20 active:scale-95 transition-all"
                        >
                            Procesar Datos
                        </button>
                    </div>
                </div>
            );
        };

        // --- APP ---
        const App = () => {
            const [tab, setTab] = useState('charts');
            const [type, setType] = useState('pie'); 
            const [exportTheme, setExportTheme] = useState('dark'); 
            const [chartTitle, setChartTitle] = useState("");
            const [centerColor, setCenterColor] = useState("#3b82f6");
            const [centerIcon, setCenterIcon] = useState("pie");
            const [centerLabel, setCenterLabel] = useState("CICLO");
            const [centerImage, setCenterImage] = useState(null); 
            const [showPasteModal, setShowPasteModal] = useState(false);
            const chartRef = useRef(null);

            const [simpleData, setSimpleData] = useState({ label: 'Ventas', value: 75, max: 100, c1: '#3b82f6', c2: '#06b6d4' });
            const [categories, setCategories] = useState([{ id: 1, label: 'Prod A', value: "40", color: '#f472b6' }, { id: 2, label: 'Prod B', value: "25", color: '#22d3ee' }, { id: 3, label: 'Serv C', value: "35", color: '#a78bfa' }]);
            const [customTotal, setCustomTotal] = useState(0);

            const chartTypes = [
                { id: 'pie', label: 'Torta Smart', icon: 'pie', mode: 'multi' },
                { id: 'ring', label: 'Anillo', icon: 'circle', mode: 'multi' },
                { id: 'position', label: 'Tabla Posiciones', icon: 'info', mode: 'multi' },
                { id: 'process', label: 'Proceso', icon: 'smart', mode: 'multi' },
                { id: 'cycle', label: 'Ciclo', icon: 'smart', mode: 'multi' },
                { id: 'pyramid', label: 'Pirámide', icon: 'pyramid', mode: 'multi' },
                { id: 'bar', label: 'Barra', icon: 'bar', mode: 'simple' },
                { id: 'gauge', label: 'Medidor', icon: 'activity', mode: 'simple' }
            ];

            const currentTypeConfig = chartTypes.find(t => t.id === type);
            const addCategory = () => setCategories([...categories, { id: Math.max(...categories.map(c=>c.id),0)+1, label: 'Nuevo', value: "10", color: '#f87171' }]);
            const updateCategory = (id, f, v) => setCategories(categories.map(c => c.id===id ? {...c, [f]:v} : c));
            const removeCategory = (id) => categories.length > 1 && setCategories(categories.filter(c => c.id!==id));

            const getRandomColor = () => {
                const colors = ['#f472b6', '#22d3ee', '#a78bfa', '#f87171', '#fbbf24', '#34d399', '#60a5fa', '#818cf8', '#e879f9'];
                return colors[Math.floor(Math.random() * colors.length)];
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => { setCenterImage(reader.result); };
                    reader.readAsDataURL(file);
                }
            };

            const handleSmartPasteImage = (imgData) => {
                setCenterImage(imgData);
                setShowPasteModal(false);
                alert("¡Imagen pegada correctamente!");
            };

            const handleSmartPaste = (text) => {
                if (!text.trim()) return;
                const rows = text.trim().split(/\r?\n/);
                
                if (currentTypeConfig.mode === 'multi') {
                    const newCats = rows.map((row, i) => {
                        const parts = row.split(/\t|,|;/);
                        let label = parts[0] ? parts[0].trim() : `Item ${i+1}`;
                        let rawVal = parts[1] ? parts[1].trim() : "0";

                        const isFirstNum = !isNaN(parseFloat(label)) && isFinite(label);
                        const isSecondNum = !isNaN(parseFloat(rawVal)) && isFinite(rawVal);

                        if (isFirstNum && !isSecondNum) {
                            const temp = label;
                            label = rawVal;
                            rawVal = temp;
                        }

                        const color = getRandomColor();
                        return { id: i + 1, label, value: rawVal, color };
                    }).filter(c => c.label !== "");
                    
                    if (newCats.length > 0) {
                        setCategories(newCats);
                        setShowPasteModal(false);
                        alert(`¡Importado! Se cargaron ${newCats.length} categorías.`);
                    }
                } else {
                    const firstRow = rows[0].split(/\t|,|;/);
                    if (firstRow.length >= 2) {
                        const val = parseFloat(firstRow[1]) || 0;
                        const max = parseFloat(firstRow[2]) || 100;
                        setSimpleData({ ...simpleData, label: firstRow[0].trim(), value: val, max: max });
                        setShowPasteModal(false);
                        alert("¡Datos importados!");
                    }
                }
            };

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-8">
                    {showPasteModal && <PasteModal onClose={() => setShowPasteModal(false)} onPaste={handleSmartPaste} onImagePaste={handleSmartPasteImage} />}
                    
                    <div className="flex flex-col md:flex-row items-center justify-between gap-6 mb-10">
                        <div>
                            <h1 className="text-5xl font-black tracking-tighter bg-gradient-to-r from-cyan-400 via-white to-purple-400 bg-clip-text text-transparent">GlassGraph</h1>
                            <p className="text-slate-400 mt-2 font-light text-lg">Crea gráficos, smart y calcula porcentajes</p>
                            <p className="text-slate-500 text-xs mt-1">Hecho por Lucas Abraham</p>
                        </div>
                        <div className="glass-panel p-1.5 rounded-full flex gap-2">
                            <button onClick={()=>setTab('charts')} className={`px-6 py-2 rounded-full font-semibold transition-all ${tab==='charts'?'bg-white text-slate-900':'text-slate-400'}`}>Gráficos</button>
                            <button onClick={()=>setTab('calc')} className={`px-6 py-2 rounded-full font-semibold transition-all ${tab==='calc'?'bg-white text-slate-900':'text-slate-400'}`}>Calculadora</button>
                        </div>
                    </div>

                    {tab === 'calc' ? <CalculatorTab /> : (
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <div className="lg:col-span-4 space-y-6">
                                <div className="glass-panel p-5 rounded-2xl">
                                    <label className="text-xs font-bold text-slate-500 mb-4 block">TIPO DE GRÁFICO</label>
                                    <div className="grid grid-cols-2 gap-3">
                                        {chartTypes.map(t => (
                                            <button key={t.id} onClick={()=>setType(t.id)} className={`p-3 rounded-xl border flex flex-col items-center gap-2 transition-all ${type===t.id?'bg-cyan-500/10 border-cyan-500 text-cyan-300':'border-white/5 text-slate-400'}`}>
                                                <Icon name={t.icon} /> <span className="text-xs font-medium">{t.label}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="glass-panel p-5 rounded-2xl max-h-[60vh] overflow-y-auto custom-scroll">
                                    <div className="mb-6">
                                        <label className="text-xs font-bold text-slate-500 mb-2 block">TÍTULO DEL GRÁFICO</label>
                                        <input type="text" value={chartTitle} onChange={e=>setChartTitle(e.target.value)} placeholder="Ej. Resultados 2024" className="w-full bg-slate-800 border border-white/10 rounded-lg p-2 text-white focus:border-cyan-500 outline-none" />
                                    </div>
                                    
                                    {/* Config Especial Torta */}
                                    {type === 'pie' && (
                                        <div className="mb-6 p-3 bg-slate-800/50 rounded-xl border border-white/5">
                                            <label className="text-xs font-bold text-slate-400 mb-2 block">CENTRO TORTA</label>
                                            <div className="flex items-center gap-2 mb-3">
                                                <input type="color" value={centerColor} onChange={e=>setCenterColor(e.target.value)} />
                                                <span className="text-xs text-slate-500">Color Fondo</span>
                                            </div>
                                            <div className="flex gap-2 justify-between mb-3">
                                                {['pie', 'star', 'dollar', 'user', 'check'].map(ic => (
                                                    <button key={ic} onClick={()=>{setCenterIcon(ic); setCenterImage(null);}} className={`p-2 rounded-lg border ${centerIcon===ic && !centerImage ? 'bg-cyan-500/20 border-cyan-500' : 'border-white/10 hover:bg-white/5'}`}>
                                                        <Icon name={ic} size={16} />
                                                    </button>
                                                ))}
                                            </div>
                                            <div>
                                                <div className="flex items-center justify-between mb-1">
                                                    <label className="text-xs text-slate-500">O subir imagen:</label>
                                                    {centerImage && <button onClick={()=>setCenterImage(null)} className="text-red-400 hover:text-red-300 text-[10px] uppercase font-bold flex items-center gap-1"><Icon name="trash" size={10} /> Borrar</button>}
                                                </div>
                                                <input type="file" accept="image/*" onChange={handleImageUpload} className="text-xs text-slate-400 w-full" />
                                            </div>
                                        </div>
                                    )}

                                    {/* Config Especial Anillo */}
                                    {type === 'ring' && (
                                        <div className="mb-6 p-3 bg-slate-800/50 rounded-xl border border-white/5">
                                            <label className="text-xs font-bold text-slate-400 mb-2 block">OPCIONES ANILLO</label>
                                            <div className="mb-2">
                                                <span className="text-[10px] text-slate-500 uppercase font-bold">Título Centro (Opcional)</span>
                                                <input type="text" value={centerLabel} onChange={e=>setCenterLabel(e.target.value)} className="w-full bg-slate-900 border border-white/10 rounded px-2 py-1 text-sm mt-1" placeholder="Ej. 100%" />
                                            </div>
                                            <div>
                                                <span className="text-[10px] text-slate-500 uppercase font-bold">Total Personalizado</span>
                                                <input type="number" value={customTotal} onChange={e=>setCustomTotal(parseFloat(e.target.value)||0)} className="w-full bg-slate-900 border border-white/10 rounded px-2 py-1 text-sm mt-1" placeholder="0 = Auto" />
                                            </div>
                                            <div className="mt-2">
                                                <div className="flex items-center justify-between mb-1">
                                                    <span className="text-[10px] text-slate-500 uppercase font-bold">Imagen Centro</span>
                                                    {centerImage && <button onClick={()=>setCenterImage(null)} className="text-red-400 hover:text-red-300 text-[10px] uppercase font-bold flex items-center gap-1"><Icon name="trash" size={10} /> Borrar</button>}
                                                </div>
                                                <input type="file" accept="image/*" onChange={handleImageUpload} className="text-xs text-slate-400 w-full mt-1" />
                                            </div>
                                        </div>
                                    )}

                                    {/* Config Especial Ciclo */}
                                    {type === 'cycle' && (
                                        <div className="mb-6">
                                            <label className="text-xs font-bold text-slate-500 mb-2 block">TEXTO CENTRAL</label>
                                            <input type="text" value={centerLabel} onChange={e=>setCenterLabel(e.target.value)} className="w-full bg-slate-800 border border-white/10 rounded-lg p-2 text-white focus:border-cyan-500 outline-none" />
                                        </div>
                                    )}

                                    {/* Smart Paste Button */}
                                    <div className="mb-4">
                                        <button 
                                            onClick={() => setShowPasteModal(true)}
                                            className="w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-cyan-300 font-bold flex items-center justify-center gap-2 transition-all active:scale-95"
                                        >
                                            <Icon name="paste" size={18} /> Pegado Inteligente
                                        </button>
                                    </div>

                                    {currentTypeConfig.mode === 'multi' ? (
                                        <div className="space-y-3">
                                            {categories.map(cat => (
                                                <div key={cat.id} className="bg-slate-800/50 p-3 rounded-xl border border-white/5 flex gap-2 items-center">
                                                    <div className="flex-1 space-y-1">
                                                        <input type="text" value={cat.label} onChange={e=>updateCategory(cat.id,'label',e.target.value)} className="w-full bg-transparent border-b border-white/10 text-sm focus:border-cyan-500 outline-none" placeholder="Etiqueta" />
                                                        <div className="flex items-center gap-2">
                                                            {/* Input de valor ahora es TEXT para soportar Smart Charts, pero parseamos a numero en charts matematicos */}
                                                            <input type="text" value={cat.value} onChange={e=>updateCategory(cat.id,'value',e.target.value)} className="w-full bg-slate-900 rounded px-2 py-1 text-sm outline-none focus:ring-1 ring-cyan-500" placeholder="Valor/Desc" />
                                                            <input type="color" value={cat.color} onChange={e=>updateCategory(cat.id,'color',e.target.value)} />
                                                        </div>
                                                    </div>
                                                    <button onClick={()=>removeCategory(cat.id)} className="text-slate-500 hover:text-red-400"><Icon name="trash" size={16}/></button>
                                                </div>
                                            ))}
                                            <button onClick={addCategory} className="w-full py-2 border border-dashed border-white/20 rounded-xl text-slate-400 hover:text-white flex justify-center gap-2 text-sm"><Icon name="plus" size={16}/> Agregar</button>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <input type="text" value={simpleData.label} onChange={e=>setSimpleData({...simpleData, label:e.target.value})} className="w-full bg-slate-800 border border-white/10 rounded-lg p-2 text-white" />
                                            <div className="flex gap-2">
                                                <input type="number" value={simpleData.value} onChange={e=>setSimpleData({...simpleData, value:parseFloat(e.target.value)||0})} className="w-1/2 bg-slate-800 border border-white/10 rounded-lg p-2" />
                                                <input type="number" value={simpleData.max} onChange={e=>setSimpleData({...simpleData, max:parseFloat(e.target.value)||0})} className="w-1/2 bg-slate-800 border border-white/10 rounded-lg p-2" />
                                            </div>
                                            <div className="flex gap-2">
                                                <input type="color" value={simpleData.c1} onChange={e=>setSimpleData({...simpleData, c1:e.target.value})} className="flex-1 h-8" />
                                                <input type="color" value={simpleData.c2} onChange={e=>setSimpleData({...simpleData, c2:e.target.value})} className="flex-1 h-8" />
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="lg:col-span-8 flex flex-col gap-6">
                                <div className={`rounded-3xl p-8 relative flex-1 flex flex-col items-center justify-center min-h-[500px] shadow-2xl transition-all ${exportTheme==='dark'?'glass-panel bg-gradient-to-br from-white/5 to-transparent':'light-panel bg-white'}`}>
                                    <div ref={chartRef} className="relative z-10 transition-transform duration-500 hover:scale-[1.01]">
                                        {type==='pie' && <ArrowPieChart categories={categories} theme={exportTheme} title={chartTitle} centerColor={centerColor} centerIcon={centerIcon} centerImage={centerImage} />}
                                        {type==='ring' && <RingChart categories={categories} customTotal={customTotal} theme={exportTheme} title={chartTitle} centerLabel={centerLabel} centerImage={centerImage} />}
                                        {type==='position' && <PositionTableChart categories={categories} theme={exportTheme} title={chartTitle} />}
                                        {type==='process' && <ProcessSmartChart categories={categories} theme={exportTheme} title={chartTitle} />}
                                        {type==='cycle' && <CycleSmartChart categories={categories} theme={exportTheme} title={chartTitle} centerLabel={centerLabel} />}
                                        {type==='pyramid' && <PyramidSmartChart categories={categories} theme={exportTheme} title={chartTitle} />}
                                        {type==='bar' && <BarChart {...simpleData} color1={simpleData.c1} color2={simpleData.c2} theme={exportTheme} title={chartTitle} />}
                                        {type==='gauge' && <GaugeChart {...simpleData} color1={simpleData.c1} color2={simpleData.c2} theme={exportTheme} title={chartTitle} />}
                                    </div>
                                    <div className="absolute top-6 right-6 flex bg-black/20 p-1 rounded-full backdrop-blur-md">
                                        <button onClick={()=>setExportTheme('dark')} className={`p-2 rounded-full ${exportTheme==='dark'?'bg-slate-700 text-white':'text-slate-400'}`}><Icon name="moon" size={16}/></button>
                                        <button onClick={()=>setExportTheme('light')} className={`p-2 rounded-full ${exportTheme==='light'?'bg-white text-yellow-500':'text-slate-400'}`}><Icon name="sun" size={16}/></button>
                                    </div>
                                </div>
                                <div className="flex justify-end gap-4">
                                    <button onClick={()=>exportChart(chartRef.current.querySelector('svg'),'copy')} className="glass-panel px-6 py-3 rounded-xl flex items-center gap-2 text-white hover:bg-white/10 font-semibold"><Icon name="copy"/> Copiar</button>
                                    <button onClick={()=>exportChart(chartRef.current.querySelector('svg'),'download')} className="bg-cyan-600 hover:bg-cyan-500 px-6 py-3 rounded-xl flex items-center gap-2 text-white font-semibold shadow-lg"><Icon name="download"/> Descargar</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
